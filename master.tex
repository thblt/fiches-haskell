\documentclass[final,a5paper,french]{article}

%%%%%%%%%%%%%
%% GENERAL %%
%%%%%%%%%%%%%
% Essentials
\usepackage[]{polyglossia}
\setdefaultlanguage{french}
\setotherlanguages{english}
\usepackage[margin=1cm, bmargin=2cm]{geometry}

% Packages
\usepackage{caption}
\usepackage{framed}
\usepackage{hyperref}
\usepackage{makeidx}
\usepackage{newfloat}
\usepackage[table]{xcolor}

%%%%%%%%%%%%%%%%%%%%%%%%%%
%% FONTS AND TYPOGRAPHY %%
%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{fontspec}
%\setmainfont{Palatino}
\setsansfont{Open Sans}
\setmonofont{InconsolataForPowerline-g}

%%%%%%%%%%%%%%%%%%
%% BIBLIOGRAPHY %%
%%%%%%%%%%%%%%%%%%
\usepackage[%
    style=authoryear,%
    hyperref=true,%
    maxcitenames=1,%
    maxbibnames=99,
    parentracker=true
    ]{biblatex}
\addbibresource{fiches.bib}

%%%%%%%%%%%%
%% TABLES %%
%%%%%%%%%%%%
\usepackage[export]{adjustbox}
\usepackage{booktabs}
\usepackage{tabularx}

\newcolumntype{R}[2]{%
    >{\adjustbox{angle=#1,lap=\width-(#2)}\bgroup}%
    l%
    <{\egroup}%
}
\newcommand*\rot{\multicolumn{1}{R{90}{1em}}}
\newcommand*\roth{\multicolumn{1}{R{45}{1em}}}

%%%%%%%%%%%%%%%%%%%%%%%%%
%% SYNTAX HIGHLIGHTING %%
%%%%%%%%%%%%%%%%%%%%%%%%%
% \usepackage[cache=false]{minted}
\usepackage{minted}
\usemintedstyle{colorful}
\definecolor{bg}{rgb}{0.95,0.95,0.95}
\newminted{haskell}{bgcolor=bg,linenos,fontsize=\small}
% The four lines below from a StackExchange question
% Fixes a bug in minted that suppresses space above&below
% a code block when using a background color.
\makeatletter
\patchcmd{\minted@colorbg}{\noindent}{\medskip\noindent}{}{}
\apptocmd{\endminted@colorbg}{\par\medskip}{}{}
\makeatother

\DeclareFloatingEnvironment[fileext=code,placement={!ht},name=Listing]{hslisting}
%\captionsetup[hslisting]{labelfont=bf}

%%%%%%%%%%%%%%%%
%% SECTIONING %%
%%%%%%%%%%%%%%%%
%\usepackage{tikz}\usetikzlibrary{shapes.misc}
\usepackage[]{titlesec}

\definecolor{titlecolor}{rgb}{0.5,0.5,1}

%% SECTIONS
% \newcommand\titlebar{%
% % Modified from: https://tex.stackexchange.com/questions/34288/how-to-place-a-shaded-box-around-a-section-label-and-name
% \tikz[baseline] {
%     \fill [cyan!25] (0ex,-1ex) rectangle (\textwidth,2.5ex);
%     \node [
%         fill=cyan!60!white,
%         anchor= base west,
%         rectangle,
%         minimum height = 3.5ex,
%         minimum width = 3.5ex,
%         ] at (0cm,0) {\sffamily\textbf{\thesection}};
% }%
% }
\titleformat{\section}[hang]
{\sffamily\Huge}
{\colorbox{titlecolor}{\textbf{\arabic{section}}}}
{.5em}
{\uppercase}
[]
\newcommand{\sectionbreak}{\clearpage}

%% SUBSECTIONS

\titleformat{\subsection}[hang]
{\center}
{}%{\arabic{subsection}.}%Label
{.5em}%Sep
{\large\sffamily}%before-code
[\hrule]%after-code

%% SUBSUBSECTIONS
\titleformat{\subsubsection}[runin]
{}
{\rule{1ex}{1ex}}%Label
{.5em}%Sep
{\sffamily\textbf}%before-code
%[]%after-code

%%%%%%%%%%%%%%%%%%
%% PLACEHOLDERS %%
%%%%%%%%%%%%%%%%%%

% Placeholders are semantic commands which deserve a better implementation,
% but should be available from the start.

\newcommand{\cmd}[2][]{#2}
\newcommand{\concept}[2][]{#2}
\newcommand{\enconcept}[2][]{\en{#2}}
\newcommand{\hsT}[2][]{\texttt{#2}}
\newcommand{\hsTC}[2][]{\texttt{#2}}
\newcommand{\coche}{\rule{.5em}{.5em}}

%%%%%%%%%%%
%% BOXES %%
%%%%%%%%%%%

\newenvironment{boxed}{\begin{framed}}{\end{framed}}
\newenvironment{iconbox}[1]{%
    \begin{boxed}\noindent%
    \parbox{1cm}{\includegraphics[height=1cm,valign=t]{#1}}\hfill\begin{minipage}{\textwidth-1cm-.5em}}{\end{minipage}
\end{boxed}}
\newenvironment{infobox}{\begin{iconbox}{./images/info.pdf}}{\end{iconbox}}

%%%%%%%%%%%%%%%%
%% SHORTHANDS %%
%%%%%%%%%%%%%%%%

\newcommand*\cf[1]{\ref{#1}.\ \textit{\nameref{#1}}}
\newcommand*\qsee[1]{\textsf{($\to$\ref{#1}})}

\newcommand*\hs[1]{\small\mintinline{haskell}{#1}\normalsize}
\newcommand*\en[1]{\textit{\begin{english}#1\end{english}}}

\newenvironment{tableau}{\begin{table}[h]\small\sffamily\rowcolors{2}{gray!25}{white}}{\end{table}}

\begin{document}

\input{fiches/_everything.tex}

\printbibliography

\end{document}
