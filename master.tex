\documentclass[final,a5paper,french]{article}

%%%%%%%%%%%%%
%% GENERAL %%
%%%%%%%%%%%%%
% Essentials
\usepackage[]{polyglossia}
\setdefaultlanguage{french}
\setotherlanguages{english}
\usepackage[margin=1cm]{geometry}

% Packages
\usepackage{calc}
\usepackage{caption}
\usepackage{csquotes}
\usepackage{etoolbox}
\usepackage{framed}
\usepackage{hyperref}
\usepackage{makeidx}
\usepackage{newfloat}
\usepackage[table,svgnames]{xcolor}

%%%%%%%%%%%%%%%%%%%%%%%%%%
%% FONTS AND TYPOGRAPHY %%
%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{fontspec}
%\setmainfont{Palatino}
\setmainfont[Ligatures=TeX]{TeX Gyre Pagella}
\setsansfont[
    UprightFont=*Light,
    ItalicFont=*LightItalic,
    BoldFont=*Bold,
    ]{OpenSans-Condensed}
\setmonofont{InconsolataForPowerline-g}
% \newfontfamily{\}{NeoSans}

%%%%%%%%%%%%%%
%% HEADINGS %%
%%%%%%%%%%%%%%
%\usepackage{fancyhdr}
\pagestyle{empty}

%%%%%%%%%%%%%%%%%%
%% BIBLIOGRAPHY %%
%%%%%%%%%%%%%%%%%%
\usepackage[%
    style=authoryear,%
    hyperref=true,%
    maxcitenames=1,%
    maxbibnames=99,
    parentracker=true
    ]{biblatex}
\addbibresource{fiches.bib}

% URLs go on a separate line.
\DeclareFieldFormat{url}{\newline\mkbibacro{URL}\addcolon\space\url{#1}}
\newbibmacro*{url+urldate}{%
 \printfield[url]{url}%
 \iffieldundef{urlyear}
 {}
 {\setunit*{\addspace}%
 \printtext[urldate]{\printurldate}}}

%%%%%%%%%%%%
%% TABLES %%
%%%%%%%%%%%%
\usepackage[export]{adjustbox}
\usepackage{booktabs}
\usepackage{tabularx}

\newcolumntype{R}[2]{%
    >{\adjustbox{angle=#1,lap=\width-(#2)}\bgroup}%
    l%
    <{\egroup}%
}
\newcommand*\rot{\multicolumn{1}{R{90}{1em}}}
\newcommand*\roth{\multicolumn{1}{R{45}{1em}}}

%%%%%%%%%%%%%%%%%%%%%%%%%
%% SYNTAX HIGHLIGHTING %%
%%%%%%%%%%%%%%%%%%%%%%%%%
% \usepackage[cache=false]{minted}
\usepackage{minted}
\usemintedstyle{colorful}
\definecolor{bg}{rgb}{0.95,0.95,0.95}
\newminted{haskell}{bgcolor=bg,linenos=false,fontsize=\small}
% The four lines below from a StackExchange question
% Fixes a bug in minted that suppresses space above&below
% a code block when using a background color.
\makeatletter
\patchcmd{\minted@colorbg}{\noindent}{\medskip\noindent}{}{}
\apptocmd{\endminted@colorbg}{\par\medskip}{}{}
\makeatother

\DeclareFloatingEnvironment[fileext=code,placement={!ht},name=Listing]{hslisting}
%\captionsetup[hslisting]{labelfont=bf}

%%%%%%%%%%%%%%%%
%% SECTIONING %%
%%%%%%%%%%%%%%%%
%\usepackage{tikz}\usetikzlibrary{shapes.misc}
\usepackage[]{titlesec}

\definecolor{titlecolor}{rgb}{0.5,0.5,1}

\titleformat{\section}[hang]
{\sffamily\Huge}
{\arabic{section}}
{.5em}
{\bfseries\uppercase}
[]
\newcommand{\sectionbreak}{\clearpage}

%% SUBSECTIONS

\titleformat{\subsection}[hang]
{\center}
{}%{\arabic{subsection}.}%Label
{.5em}%Sep
{\large\sffamily}%before-code
[\hrule]%after-code

%% SUBSUBSECTIONS
\titleformat{\subsubsection}[runin]
{}
{\rule{1ex}{1ex}}%Label
{.5em}%Sep
{\sffamily\textbf}%before-code
%[]%after-code

%%%%%%%%%%%%%%%%%%
%% PLACEHOLDERS %%
%%%%%%%%%%%%%%%%%%

% Placeholders are semantic commands which deserve a better implementation,
% but should be available from the start.

\newcommand{\cmd}[2][]{#2}
\newcommand{\concept}[2][]{#2}
\newcommand{\enconcept}[2][]{\en{#2}}
\newcommand{\hsT}[2][]{\texttt{#2}}  % Haskell Type
\newcommand{\hsTC}[2][]{\texttt{#2}} % Haskell Type Class
\newcommand{\hsTP}[2][]{\texttt{#2}} % Haskell Type Parameter
\newcommand{\hsFn}[2][]{\texttt{#2}} % Haskell Function (or variable)
\newcommand{\coche}{\rule{.5em}{.5em}}

%%%%%%%%%%%%%%%%%%%%%%
%% BOXES AND BLOCKS %%
%%%%%%%%%%%%%%%%%%%%%%

% Utility environments

\newenvironment{iconbox}[3]{% Parameters : icon width, icon file, title
    \noindent\begin{minipage}[t][][t]{\textwidth}
        \noindent%
        \begin{minipage}[t][][c]{#1}\noindent\includegraphics[width=#1]{#2}\end{minipage}%
            \hfill%
            \begin{minipage}[t][][c]{\textwidth-#1-\FrameSep}%
                \ifx&#3&\else%
                \textbf{#3}\par\medskip%
                \fi%
}{%
        \end{minipage}%
    \end{minipage}}

\newlength{\boxiconwidth}
\setlength{\boxiconwidth}{2em}

\newenvironment{iconblock}[2]{% Params : icon width, icon file
    \begin{iconbox}{#1}{#2}{}%
}{
    \end{iconbox}}

% User environements

\newenvironment{infobox}[1][]{\begin{framed}\begin{iconbox}{\boxiconwidth}{./images/info.pdf}{#1}}{\end{iconbox}\end{framed}}
\newenvironment{refbox}[1][]{\begin{framed}\begin{iconbox}{\boxiconwidth}{./images/ref.pdf}{#1}}{\end{iconbox}\end{framed}}

\newenvironment{refblock}{\begin{iconblock}{\totalheightof{X}}{./images/ref.pdf}}{\end{iconblock}}

%%%%%%%%%%%%%%%%
%% SHORTHANDS %%
%%%%%%%%%%%%%%%%
\usepackage{tikz}
\newcommand*\circled[1]{\tikz[baseline=(char.base)]{
            \node[shape=circle,fill=Black,inner sep=1pt] (char) {\textcolor{White}{#1}};}}
\newcommand*\cf[1]{\ref{#1}.\ \textit{\nameref{#1}}}
% \newcommand*\qsee[1]{\textsf{($\to$\ref{#1}})}
\usepackage{nameref}
\newcommand*\qsee[1]{\circled{\sffamily\footnotesize\bfseries\ref{#1}}}
\newcommand*\fsee[1]{\sffamily\ref{#1} : \bfseries\nameref{#1}}

\newcommand*\hs[1]{\small\mintinline[bgcolor=bg]{haskell}{#1}\normalsize}
\newcommand*\en[1]{\textit{\begin{english}#1\end{english}}}

\newenvironment{tableau}{\begin{table}[h]\small\sffamily\rowcolors{2}{gray!25}{white}}{\end{table}}

\begin{document}

\input{fiches/_everything.tex}

\printbibliography

\end{document}
