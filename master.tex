\documentclass[final,a5paper,french]{article}

%%%%%%%%%%%%%
%% GENERAL %%
%%%%%%%%%%%%%
% Essentials
\usepackage[]{polyglossia}
\setdefaultlanguage{french}
\setotherlanguages{english}
\usepackage[margin=1cm, bmargin=2cm]{geometry}

% Packages
\usepackage{caption}
\usepackage{etoolbox}
\usepackage{framed}
\usepackage{hyperref}
\usepackage{makeidx}
\usepackage{newfloat}
\usepackage[table]{xcolor}

%%%%%%%%%%%%%%%%%%%%%%%%%%
%% FONTS AND TYPOGRAPHY %%
%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{fontspec}
%\setmainfont{Palatino}
\setsansfont[
    UprightFont=*Light,
    ItalicFont=*LightItalic,
    BoldFont=*Bold,
    ]{OpenSans-Condensed}
\setmonofont{InconsolataForPowerline-g}
% \newfontfamily{\}{NeoSans}

%%%%%%%%%%%%%%%%%%
%% BIBLIOGRAPHY %%
%%%%%%%%%%%%%%%%%%
\usepackage[%
    style=authoryear,%
    hyperref=true,%
    maxcitenames=1,%
    maxbibnames=99,
    parentracker=true
    ]{biblatex}
\addbibresource{fiches.bib}

% URLs go on a separate line.
\DeclareFieldFormat{url}{\newline\mkbibacro{URL}\addcolon\space\url{#1}}
\newbibmacro*{url+urldate}{%
 \printfield[url]{url}%
 \iffieldundef{urlyear}
 {}
 {\setunit*{\addspace}%
 \printtext[urldate]{\printurldate}}}

%%%%%%%%%%%%
%% TABLES %%
%%%%%%%%%%%%
\usepackage[export]{adjustbox}
\usepackage{booktabs}
\usepackage{tabularx}

\newcolumntype{R}[2]{%
    >{\adjustbox{angle=#1,lap=\width-(#2)}\bgroup}%
    l%
    <{\egroup}%
}
\newcommand*\rot{\multicolumn{1}{R{90}{1em}}}
\newcommand*\roth{\multicolumn{1}{R{45}{1em}}}

%%%%%%%%%%%%%%%%%%%%%%%%%
%% SYNTAX HIGHLIGHTING %%
%%%%%%%%%%%%%%%%%%%%%%%%%
% \usepackage[cache=false]{minted}
\usepackage{minted}
\usemintedstyle{colorful}
\definecolor{bg}{rgb}{0.95,0.95,0.95}
\newminted{haskell}{bgcolor=bg,linenos,fontsize=\small}
% The four lines below from a StackExchange question
% Fixes a bug in minted that suppresses space above&below
% a code block when using a background color.
\makeatletter
\patchcmd{\minted@colorbg}{\noindent}{\medskip\noindent}{}{}
\apptocmd{\endminted@colorbg}{\par\medskip}{}{}
\makeatother

\DeclareFloatingEnvironment[fileext=code,placement={!ht},name=Listing]{hslisting}
%\captionsetup[hslisting]{labelfont=bf}

%%%%%%%%%%%%%%%%
%% SECTIONING %%
%%%%%%%%%%%%%%%%
%\usepackage{tikz}\usetikzlibrary{shapes.misc}
\usepackage[]{titlesec}

\definecolor{titlecolor}{rgb}{0.5,0.5,1}

\titleformat{\section}[hang]
{\sffamily\Huge}
{\arabic{section}}
{.5em}
{\bfseries\uppercase}
[]
\newcommand{\sectionbreak}{\clearpage}

%% SUBSECTIONS

\titleformat{\subsection}[hang]
{\center}
{}%{\arabic{subsection}.}%Label
{.5em}%Sep
{\large\sffamily}%before-code
[\hrule]%after-code

%% SUBSUBSECTIONS
\titleformat{\subsubsection}[runin]
{}
{\rule{1ex}{1ex}}%Label
{.5em}%Sep
{\sffamily\textbf}%before-code
%[]%after-code

%%%%%%%%%%%%%%%%%%
%% PLACEHOLDERS %%
%%%%%%%%%%%%%%%%%%

% Placeholders are semantic commands which deserve a better implementation,
% but should be available from the start.

\newcommand{\cmd}[2][]{#2}
\newcommand{\concept}[2][]{#2}
\newcommand{\enconcept}[2][]{\en{#2}}
\newcommand{\hsT}[2][]{\texttt{#2}}
\newcommand{\hsTC}[2][]{\texttt{#2}}
\newcommand{\coche}{\rule{.5em}{.5em}}

%%%%%%%%%%%
%% BOXES %%
%%%%%%%%%%%

\newenvironment{boxed}{\begin{framed}\noindent\begin{minipage}[t][][t]{\textwidth}}{\end{minipage}\end{framed}}
%\newenvironment{boxed}{\begin{framed}}{\end{framed}}
\newenvironment{iconbox}[2]{%
    \begin{boxed}%
        \noindent%
        \begin{minipage}[t][][c]{1cm}\noindent\includegraphics[height=1cm,width=1cm]{#1}\end{minipage}%
            \hfill%
            \begin{minipage}[t][][c]{\textwidth-1cm-\FrameSep}%
                \ifx&#2&\else%
                \textbf{#2}\par\medskip%
                \fi%
}{%
        \end{minipage}%
    \end{boxed}}

\newenvironment{infobox}[1]{\begin{iconbox}{./images/info.pdf}{#1}}{\end{iconbox}}
\newenvironment{infobox*}{\begin{iconbox}{./images/info.pdf}{}}{\end{iconbox}}

%%%%%%%%%%%%%%%%
%% SHORTHANDS %%
%%%%%%%%%%%%%%%%

\newcommand*\cf[1]{\ref{#1}.\ \textit{\nameref{#1}}}
\newcommand*\qsee[1]{\textsf{($\to$\ref{#1}})}

\newcommand*\hs[1]{\small\mintinline{haskell}{#1}\normalsize}
\newcommand*\en[1]{\textit{\begin{english}#1\end{english}}}

\newenvironment{tableau}{\begin{table}[h]\small\sffamily\rowcolors{2}{gray!25}{white}}{\end{table}}

\begin{document}

\input{fiches/_everything.tex}

\printbibliography

\end{document}
