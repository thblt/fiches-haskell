\documentclass[a5paper,french]{article}

\usepackage[]{polyglossia}
\setdefaultlanguage{french}
\setotherlanguages{english}
\usepackage[margin=1cm, bmargin=2cm]{geometry}
\usepackage{framed}
\usepackage{booktabs}
\usepackage{hyperref}
\usepackage{makeidx}
\usepackage[table]{xcolor}

% Fonts
\usepackage{fontspec}
%\setmainfont{Palatino}
\setsansfont{Avenir Next Condensed}
\setmonofont{InconsolataForPowerline-g}

% Tables
\usepackage{adjustbox}
\usepackage{array}
\usepackage{tabularx}

\newcolumntype{R}[2]{%
    >{\adjustbox{angle=#1,lap=\width-(#2)}\bgroup}%
    l%
    <{\egroup}%
}
\newcommand*\rot{\multicolumn{1}{R{90}{1em}}}
\newcommand*\roth{\multicolumn{1}{R{45}{1em}}}

% === Minted ===
\usepackage[cache=false]{minted}
\usemintedstyle{colorful}
\definecolor{bg}{rgb}{0.95,0.95,0.95}
\newminted{haskell}{bgcolor=bg,linenos,fontsize=\small}
% The four lines below from a StackExchange question
% Fixes a bug in minted that suppresses space above&below
% a code block when using a background color.
\makeatletter
\patchcmd{\minted@colorbg}{\noindent}{\medskip\noindent}{}{}
\apptocmd{\endminted@colorbg}{\par\medskip}{}{}
\makeatother
% \usepackage{listings}
% \lstset{
%   frame=none,
%   xleftmargin=2pt,
%   stepnumber=1,
%   numbers=left,
%   numbersep=5pt,
%   numberstyle=\ttfamily\tiny\color[gray]{0.3},
%   belowcaptionskip=\bigskipamount,
%   captionpos=b,
%   escapeinside={*'}{'*},
%   language=haskell,
%   tabsize=2,
%   emphstyle={\bf},
%   commentstyle=\it,
%   stringstyle=\mdseries\rmfamily,
%   showspaces=false,
%   keywordstyle=\bfseries\rmfamily,
%   columns=flexible,
%   basicstyle=\small\sffamily,
%   showstringspaces=false,
%   morecomment=[l]\%,
% }
% Bibliography
\usepackage[
    backend=biber,%
    style=authoryear,%
    maxnames=1%
    ]{biblatex}
\addbibresource{fiches.bib}

% Sectioning and TOC
\usepackage[explicit]{titlesec}
\usepackage{titletoc}
\definecolor{shadecolor}{rgb}{0.95,0.95,0.95}

\titleformat{\section}[frame]
{\setlength\fboxrule{2.25pt}}
{}
{5mm}
{%
\begin{shaded}%
    \arabic{section}%
\end{shaded}%
\Large\sffamily\filcenter\MakeUppercase{#1}}

\newcommand{\sectionbreak}{\clearpage}

\titleformat{\subsection}[hang]
{\center}
{}%{\arabic{subsection}.}%Label
{.5em}%Sep
{\large\sffamily\textbf{#1}}%before-code
[\hrule]%after-code

\titleformat{\subsubsection}[runin]
{}
{}%Label
{.5em}%Sep
{#1}%before-code
%[]%after-code

%Placeholders
% \newcommand\code[1]{\texttt{#1}}
\newcommand{\cmd}[2][]{#2}
\newcommand{\concept}[2][]{#2}
\newcommand{\enconcept}[2][]{\en{#2}}
\newcommand{\hsT}[2][]{\texttt{#2}}
\newcommand{\hsTC}[2][]{\texttt{#2}}
\newcommand{\coche}{\rule{.5em}{.5em}}

% Shorthands
\newcommand\hs[1]{\mintinline{haskell}{#1}}
\newcommand\en[1]{\textit{\begin{english}#1\end{english}}}

\newenvironment{tableau}{\begin{table}[h]\small\sffamily}{\end{table}}





\usepackage{tikz}\usetikzlibrary{shapes.misc}
\newcommand\titlebar{%
\tikz[baseline,trim left=3.1cm,trim right=3cm] {
    \fill [cyan!25] (2.5cm,-1ex) rectangle (\textwidth+3.1cm,2.5ex);
    \node [
        fill=cyan!60!white,
        anchor= base east,
        rounded rectangle,
        minimum height=3.5ex] at (3cm,0) {
        \textbf{\arabic{chapter}.\thesection.}
    };
}%
}
\titleformat{\section}{\Huge}{\titlebar #1}{0.1cm}{}

\begin{document}

\input{fiches/_everything}

\appendix

\printbibliography

\section{Index}

\printindex

\end{document}
