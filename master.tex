\documentclass[final,a5paper,french]{article}

%%%%%%%%%%%%%
%% GENERAL %%
%%%%%%%%%%%%%
% Essentials
\usepackage[]{polyglossia}
\setdefaultlanguage{french}
\setotherlanguages{english}
\usepackage[margin=1cm]{geometry}
\usepackage[table,svgnames]{xcolor}

% Common packages
\usepackage{amsmath}
\usepackage{calc}
\usepackage{caption}
\usepackage{csquotes}
\usepackage{etoolbox}
\usepackage[inline]{enumitem}
\usepackage{framed}
\usepackage{hyperref}
\usepackage{makeidx}
\usepackage{newfloat}
\usepackage{soul}
\usepackage{todonotes}
\presetkeys{todonotes}{inline}{}

%%%%%%%%%%%%%%%%%%%%%%%%%%
%% FONTS AND TYPOGRAPHY %%
%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{fontspec}
%\setmainfont{Palatino}
\setmainfont[Scale=MatchLowercase]{TeX Gyre Pagella}
\setsansfont[
    UprightFont=*Light,
    ItalicFont=*LightItalic,
    BoldFont=*Bold,
    Scale=MatchLowercase
    ]{OpenSans-Condensed}
\setmonofont[Scale=MatchLowercase]{Source Code Pro}

%%%%%%%%%%%
%% LISTS %%
%%%%%%%%%%%
\newlist{ilenum}{enumerate*}{1}
\setlist[ilenum]{label=\arabic*,afterlabel=)\ }

%%%%%%%%%%%%%%
%% HEADINGS %%
%%%%%%%%%%%%%%
%\usepackage{fancyhdr}
\pagestyle{empty}

%%%%%%%%%%%%%%%%%%
%% BIBLIOGRAPHY %%
%%%%%%%%%%%%%%%%%%
\usepackage[%
    style=authoryear,%
    hyperref=true,%
    maxcitenames=1,%
    maxbibnames=99,
    parentracker=true
    ]{biblatex}
\addbibresource{fiches.bib}

% URLs go on a separate line.
\DeclareFieldFormat{url}{\newline\mkbibacro{URL}\addcolon\space\url{#1}}
\newbibmacro*{url+urldate}{%
 \printfield[url]{url}%
 \iffieldundef{urlyear}
 {}
 {\setunit*{\addspace}%
 \printtext[urldate]{\printurldate}}}

%%%%%%%%%%%%
%% TABLES %%
%%%%%%%%%%%%
\usepackage[export]{adjustbox}
\usepackage{booktabs}
\usepackage{tabularx}

\newcolumntype{R}[2]{%
    >{\adjustbox{angle=#1,lap=\width-(#2)}\bgroup}%
    l%
    <{\egroup}%
}
\newcommand*\rot{\multicolumn{1}{R{90}{1em}}}
\newcommand*\roth{\multicolumn{1}{R{45}{1em}}}

%%%%%%%%%%%%%%%%%%%%%%%%%
%% SYNTAX HIGHLIGHTING %%
%%%%%%%%%%%%%%%%%%%%%%%%%
% \usepackage[cache=false]{minted}
\usepackage[]{minted}
\usemintedstyle{colorful}
\definecolor{bg}{rgb}{0.95,0.95,0.95}
\newminted{haskell}{bgcolor=bg,linenos=false,fontsize=\small, breaklines=true}
% The four lines below from a StackExchange question
% Fixes a bug in minted that suppresses space above&below
% a code block when using a background color.
\makeatletter
\patchcmd{\minted@colorbg}{\noindent}{\medskip\noindent}{}{}
\apptocmd{\endminted@colorbg}{\par\medskip}{}{}
\makeatother
% This from the minted documentation: prevents polyglossia with French from
% adding undesirable extra spaces in code.
\BeforeBeginEnvironment{minted}{\begin{english}}
\AfterEndEnvironment{minted}{\end{english}}

\DeclareFloatingEnvironment[fileext=code,placement={!ht},name=Listing]{hslisting}
%\captionsetup[hslisting]{labelfont=\sffamily}

%%%%%%%%%%%%%%%%
%% SECTIONING %%
%%%%%%%%%%%%%%%%
%\usepackage{tikz}\usetikzlibrary{shapes.misc}
\usepackage[]{titlesec}

%% PARTS
\titleformat{\part}[block]
{\hspace{2cm}\sffamily\fontsize{50}{1.2}\selectfont}
{\makebox[2cm][r]{\Alph{part}.\ }}
{0cm}
{\bfseries\uppercase}
[]
\titlespacing*{\part}{0cm}{4cm}{0cm}[0cm]
\titleclass{\part}{top}
\assignpagestyle{\part}{empty}
%% SECTIONS
\titleformat{\section}[hang]
{\sffamily\Huge}
{\arabic{section}}
{.5em}
{\bfseries\uppercase}
[\glsresetall]
\newcommand{\sectionbreak}{\clearpage}
% \titleclass{\section}{top}

%% SUBSECTIONS

\titleformat{\subsection}[hang]
{\center}
{}%{\arabic{subsection}.}%Label
{.5em}%Sep
{\large\sffamily\uppercase}%before-code
[\hrule]%after-code

%% SUBSUBSECTIONS
\titleformat{\subsubsection}[runin]
{}
{}%Label
{0em}%Sep
{\hspace{-2ex}\rule{1ex}{1ex}\hspace{.5em}\sffamily\textbf}%before-code
%[]%after-code

% Part introduction
\newenvironment{introduction}{%
    \vspace{1cm}%
    \par\null\hfill\begin{minipage}{\textwidth-4cm-1ex}%
}{%
    \end{minipage}%
}

%%%%%%%%%%%%%%
%% GLOSSARY %%
%%%%%%%%%%%%%%

\usepackage[toc, xindy, nonumberlist]{glossaries}
\defglsentryfmt[main]{\glsgenentryfmt\ifglsused{\glslabel}{}{\textbf *}}
\renewcommand*{\glstextformat}[1]{\ifglsused{\glslabel}{#1}{\textbf{#1}}}
\makeglossaries
\input{glossary.tex}

%%%%%%%%%%%%%%%%%%
%% PLACEHOLDERS %%
%%%%%%%%%%%%%%%%%%

% Placeholders are semantic commands which deserve a better implementation,
% but should be available from the start.

\newcommand{\cmd}[2][]{#2}
\newcommand{\concept}[2][]{#2}
\newcommand{\enconcept}[2][]{\en{#2}}
\newcommand{\hsC}[2][]{\texttt{#2}}  % Haskell Constructor
\newcommand{\hsFn}[2][]{\texttt{#2}} % Haskell Function (or variable)
\newcommand{\hsKw}[2][]{\texttt{#2}} % Haskell Keyword
\newcommand{\hsM}[2][]{\texttt{#2}}  % Haskell Monad
\newcommand{\hsMod}[2][]{\texttt{#2}} % Haskell Module
\newcommand{\hsT}[2][]{\texttt{#2}}  % Haskell Type
\newcommand{\hsTC}[2][]{\texttt{#2}} % Haskell Type Class
\newcommand{\hsTP}[2][]{\texttt{#2}} % Haskell Type Parameter
\newcommand{\Y}{\rule{.5em}{.5em}}

\newcommand*\preTwentyTen[1]{\begin{framed}\sffamily Haskell 2010 or \texttt{#1} extension.\end{framed}}

%%%%%%%%%%%%%%%%%%%%%%
%% BOXES AND BLOCKS %%
%%%%%%%%%%%%%%%%%%%%%%

% Utility environments

\newenvironment{iconbox}[3]{% Parameters : icon width, icon file, title
    \noindent\begin{minipage}[t][][t]{\textwidth}
        \noindent%
        \begin{minipage}[t][][c]{#1}\noindent\includegraphics[width=#1]{#2}\end{minipage}%
            \hfill%
            \begin{minipage}[t][][c]{\textwidth-#1-\FrameSep}%
                \ifx&#3&\else%
                \textbf{#3}\par\medskip%
                \fi%
}{%
        \end{minipage}%
    \end{minipage}}

\newlength{\boxiconwidth}
\setlength{\boxiconwidth}{2em}

\newenvironment{iconblock}[2]{% Params : icon width, icon file
    \begin{iconbox}{#1}{#2}{}%
}{
    \end{iconbox}}

% User environements

\newenvironment{infobox}[1][]{\begin{framed}\begin{iconbox}{\boxiconwidth}{./images/info.pdf}{#1}}{\end{iconbox}\end{framed}}
\newenvironment{warnbox}[1][]{\begin{framed}\begin{iconbox}{\boxiconwidth}{./images/warn.pdf}{#1}}{\end{iconbox}\end{framed}}
\newenvironment{compatbox}[1][]{\begin{framed}\begin{iconbox}{\boxiconwidth}{./images/compat.pdf}{#1}}{\end{iconbox}\end{framed}}
\newenvironment{refbox}[1][]{\begin{framed}\begin{iconbox}{\boxiconwidth}{./images/ref.pdf}{#1}}{\end{iconbox}\end{framed}}

\newenvironment{infoblock}{\begin{iconblock}{\totalheightof{X}}{./images/info.pdf}}{\end{iconblock}}
\newenvironment{warnblock}{\begin{iconblock}{\totalheightof{X}}{./images/warn.pdf}}{\end{iconblock}}
\newenvironment{compatblock}{\begin{iconblock}{\totalheightof{X}}{./images/compat.pdf}}{\end{iconblock}}
\newenvironment{refblock}{\begin{iconblock}{\totalheightof{X}}{./images/ref.pdf}}{\end{iconblock}}

% Some more commands

\newenvironment{halfwidth}{%
    \noindent\begin{minipage}[t][][l]{\textwidth/2-.5em}%
}{%
    \end{minipage}%
}

%%%%%%%%%%%%%%%%
%% SHORTHANDS %%
%%%%%%%%%%%%%%%%

\usepackage{nameref}
\newcommand\qsee[2]{#1\textsuperscript{\ref{#2}}}
%\circled{\sffamily\footnotesize\bfseries\ref{#2}}}

\newcommand*\fsee[1]{\ref{#1}: \textsf{\bfseries\nameref{#1}}}

\newcommand*\hs[1]{\mintinline[breaklines=true]{haskell}{#1}}
\newcommand*\en[1]{\textit{\begin{english}#1\end{english}}}

\newenvironment{tableau}{\begin{table}[h]\small\sffamily\rowcolors{2}{gray!25}{white}}{\end{table}}

\begin{document}

\input{fiches/_everything.tex}

\printbibliography

\glossarystyle{altlist}
\printglossaries

\tableofcontents

\end{document}
